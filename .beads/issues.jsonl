{"id":"the-shed-roa","title":"Session Logging: Capture and Export Detailed Practice Data","description":"## Executive Summary\n\nAdd comprehensive session logging to Piano Tutor that captures every MIDI event during practice sessions, enabling users to export and analyze their mistake patterns over time. This transforms ephemeral in-session stats into persistent, analyzable data.\n\n## Problem Statement\n\nThe Piano Tutor app currently shows in-session stats (round count, first-try %, mistakes) but doesn't persist detailed practice data. Users cannot analyze patterns in their mistakes over time or identify which specific challenges (chords, intervals, progressions) cause consistent trouble. \n\n**Current State:** Stats disappear after each session; no way to identify persistent weak areas.\n**Desired State:** Exportable practice data with keystroke-level detail for pattern analysis.\n\n## Phases\n\n1. Core Logging Infrastructure - Global state and lifecycle functions\n2. MIDI Handler Instrumentation - Capture every noteOn/noteOff with timing\n3. Mode Instrumentation - Hook all 20 practice modes into logging\n4. Header Toggle Button - Quick on/off toggle during practice\n5. Session Log Panel - Management interface for viewing/exporting data\n6. JSON Export - Full structured data export\n7. CSV Export Functions - Summary and detailed CSV formats\n8. Storage Management - 100 session limit with export prompts\n9. Settings Persistence - Remember enabled state across reloads\n\n## Success Criteria\n\n- [ ] Can export practice data and identify which specific chord types/intervals have highest mistake rates\n- [ ] Data includes enough detail to see what wrong notes were played (not just \"you made a mistake\")\n- [ ] Logging works consistently across all 20 practice modes\n\n## Key Risks\n\n- Large codebase (single file ~13k lines) - work in focused sections\n- 20 modes to instrument - checklist approach, verify all covered\n- localStorage limits (~5MB) - 100 session cap with size monitoring\n- Performance impact - guard checks are fast, only record when enabled\n\n## Reference\n\nSpecification: thoughts/specs/2026-01-17-session-logging.md\nImplementation notes: docs/session-logging.md","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-17T12:01:01.921775136-08:00","created_by":"Wilfred Allyn","updated_at":"2026-01-17T12:01:01.921775136-08:00"}
{"id":"the-shed-roa.1","title":"Core Logging Infrastructure","description":"Implement the foundational logging infrastructure that all other session logging features depend on.\n\n**What needs to be built:**\n- Global state variables: `sessionLogEnabled`, `sessionLogSessions`, `currentSessionLog`\n- Session lifecycle functions for starting, recording, and ending sessions\n- Challenge normalizer to extract consistent `{prompt, pitchClasses}` from any mode's challenge format\n\n**Scope boundaries:**\n- Only the core infrastructure - no UI, no exports, no mode integration\n- Add around line 4268 in index.html per docs/session-logging.md","design":"## Task Context\nFoundation that all other features depend on. Defines the data structure and lifecycle management. Without this, nothing else can work.\n\n**Work Item:** 1 - Core Logging Infrastructure | **Epic:** the-shed-roa | **Spec:** thoughts/specs/2026-01-17-session-logging.md","acceptance_criteria":"Challenge normalizer handles all mode-specific challenge formats","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-17T12:01:17.041208837-08:00","created_by":"Wilfred Allyn","updated_at":"2026-01-17T19:05:37.115875-05:00","closed_at":"2026-01-17T19:05:37.115875-05:00","close_reason":"Completed - syncing state from main","dependencies":[{"issue_id":"the-shed-roa.1","depends_on_id":"the-shed-roa","type":"parent-child","created_at":"2026-01-17T12:01:17.042519629-08:00","created_by":"Wilfred Allyn"}]}
{"id":"the-shed-roa.10","title":"Session Log Panel","description":"Build the main management interface for session logging.\n\n**What needs to be built:**\n- Collapsible panel (hidden by default, around line 186)\n- Enable/disable toggle with label\n- Storage stats display: \"X/100 sessions (~Y KB)\"\n- Export buttons: JSON, Summary CSV, Detailed CSV\n- Recent sessions list (last 5-10 sessions with mode, date, round count)\n- Clear All Data button with confirmation prompt\n- Panel state persistence (expanded/collapsed)\n\n**Scope boundaries:**\n- This is the UI wrapper that calls export functions (built in separate tasks)\n- Does not include storage limit notifications (that's Storage Management task)","design":"## Task Context\nProvides detailed management interface for viewing, exporting, and clearing logged data. This is the primary interface for users who want to work with their practice data.\n\n**Work Item:** 5 - Session Log Panel | **Epic:** the-shed-roa | **Spec:** thoughts/specs/2026-01-17-session-logging.md","acceptance_criteria":"Panel state (expanded/collapsed) persists across reloads","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-17T12:02:41.310019543-08:00","created_by":"Wilfred Allyn","updated_at":"2026-01-17T12:02:41.310019543-08:00","dependencies":[{"issue_id":"the-shed-roa.10","depends_on_id":"the-shed-roa","type":"parent-child","created_at":"2026-01-17T12:02:41.311342918-08:00","created_by":"Wilfred Allyn"},{"issue_id":"the-shed-roa.10","depends_on_id":"the-shed-roa.7","type":"blocks","created_at":"2026-01-17T12:02:52.257310507-08:00","created_by":"Wilfred Allyn"},{"issue_id":"the-shed-roa.10","depends_on_id":"the-shed-roa.8","type":"blocks","created_at":"2026-01-17T12:02:52.296526465-08:00","created_by":"Wilfred Allyn"}]}
{"id":"the-shed-roa.11","title":"Storage Management","description":"Implement storage limits and notifications to prevent localStorage overflow.\n\n**What needs to be built:**\n- 100 session maximum enforcement\n- Notification at 90+ sessions: \"Storage nearly full (95/100). Export your data?\"\n- Prompt at 100 sessions before new session starts\n- Offer to clear oldest N sessions after export\n- Storage size estimate calculation (from JSON string length)\n\n**Scope boundaries:**\n- Only the storage management logic and notifications\n- Storage stats display is in Session Log Panel task","design":"## Task Context\nPrevents localStorage from filling up (~5MB limit) while protecting user data. 100 sessions estimated at ~1.5MB max.\n\n**Work Item:** 8 - Storage Management | **Epic:** the-shed-roa | **Spec:** thoughts/specs/2026-01-17-session-logging.md","acceptance_criteria":"Storage size estimate shown in panel (calculated from JSON string length)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-17T12:02:41.450880668-08:00","created_by":"Wilfred Allyn","updated_at":"2026-01-17T12:02:41.450880668-08:00","dependencies":[{"issue_id":"the-shed-roa.11","depends_on_id":"the-shed-roa","type":"parent-child","created_at":"2026-01-17T12:02:41.451565626-08:00","created_by":"Wilfred Allyn"},{"issue_id":"the-shed-roa.11","depends_on_id":"the-shed-roa.10","type":"blocks","created_at":"2026-01-17T12:02:54.374177924-08:00","created_by":"Wilfred Allyn"}]}
{"id":"the-shed-roa.12","title":"Mode Instrumentation: All 20 Modes","description":"Add logging hooks to all 20 practice modes. Uses identical pattern for each mode.\n\n**Modes to instrument (20 total):**\n\nChords Group:\n1. chords, 2. inversions, 3. arpeg, 4. arpeg-inv, 5. voicing, 6. voice-leading, 7. chord-prog\n\nScales \u0026 Intervals Group:\n8. scales, 9. scale-id, 10. intervals, 11. interval-id, 12. rel-pitch, 13. ear-train\n\nTheory \u0026 Skills Group:\n14. note-id, 15. key-sig, 16. ii-v-i, 17. tritone-sub, 18. melody-match, 19. rhythm, 20. sight-read\n\n**Pattern for each mode (identical):**\n- StartGame() calls sessionLogStartSession(mode, config)\n- NextChallenge() calls sessionLogStartRound(challenge)\n- Correct-answer handler calls sessionLogEndRound(result)\n- EndGame() calls sessionLogEndSession(summary)\n\n**Scope boundaries:**\n- All 20 modes in one pass (pattern is identical per spec)\n- Does not include MIDI handler (separate task)","design":"## Task Context\nConnects the logging infrastructure to all practice modes. Same pattern for each - can be done in one pass since pattern is identical.\n\n**Work Item:** 3 - Mode Instrumentation | **Epic:** the-shed-roa | **Spec:** thoughts/specs/2026-01-17-session-logging.md","acceptance_criteria":"Each EndGame() calls sessionLogEndSession(summary)","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-17T12:13:48.12722413-08:00","created_by":"Wilfred Allyn","updated_at":"2026-01-17T12:13:48.12722413-08:00","dependencies":[{"issue_id":"the-shed-roa.12","depends_on_id":"the-shed-roa","type":"parent-child","created_at":"2026-01-17T12:13:48.128574671-08:00","created_by":"Wilfred Allyn"},{"issue_id":"the-shed-roa.12","depends_on_id":"the-shed-roa.1","type":"blocks","created_at":"2026-01-17T12:13:53.592824632-08:00","created_by":"Wilfred Allyn"}]}
{"id":"the-shed-roa.2","title":"MIDI Handler Instrumentation","description":"Add logging calls to the MIDI handler to capture every note played during practice.\n\n**What needs to be built:**\n- Modify handleMIDI() to call sessionLogRecordEvent on noteOn/noteOff\n- Include guards to only record when logging is enabled and a session is active\n- Calculate isCorrect flag based on expected pitch classes\n\n**Scope boundaries:**\n- Only the handleMIDI() modifications around line 4455\n- Does not include mode-specific handlers (those are separate tasks)","design":"## Task Context\nCaptures the raw input data - every note the user plays with precise timing. This is the keystroke-level detail that enables mistake pattern analysis.\n\n**Work Item:** 2 - MIDI Handler Instrumentation | **Epic:** the-shed-roa | **Spec:** thoughts/specs/2026-01-17-session-logging.md","acceptance_criteria":"Each event includes isCorrect flag based on expected pitch classes","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-17T12:02:12.776198752-08:00","created_by":"Wilfred Allyn","updated_at":"2026-01-17T12:02:12.776198752-08:00","dependencies":[{"issue_id":"the-shed-roa.2","depends_on_id":"the-shed-roa","type":"parent-child","created_at":"2026-01-17T12:02:12.777491502-08:00","created_by":"Wilfred Allyn"},{"issue_id":"the-shed-roa.2","depends_on_id":"the-shed-roa.1","type":"blocks","created_at":"2026-01-17T12:02:50.813706506-08:00","created_by":"Wilfred Allyn"}]}
{"id":"the-shed-roa.3","title":"Mode Instrumentation: Chords Group (7 modes)","description":"Add logging hooks to the chord-related practice modes.\n\n**Modes to instrument:**\n1. chords - Basic chord identification\n2. inversions - Chord inversions\n3. arpeg - Arpeggio practice\n4. arpeg-inv - Arpeggio inversions\n5. voicing - Chord voicings\n6. voice-leading - Voice leading practice\n7. chord-prog - Chord progressions\n\n**Pattern for each mode:**\n- StartGame() calls sessionLogStartSession(mode, config)\n- NextChallenge() calls sessionLogStartRound(challenge)\n- Correct-answer handler calls sessionLogEndRound(result)\n- EndGame() calls sessionLogEndSession(summary)\n\n**Scope boundaries:**\n- Only these 7 modes - other mode groups are separate tasks","design":"## Task Context\nConnects the logging infrastructure to chord-related practice modes. Same pattern for each mode - StartGame/NextChallenge/EndRound/EndGame lifecycle hooks.\n\n**Work Item:** 3 - Mode Instrumentation | **Epic:** the-shed-roa | **Spec:** thoughts/specs/2026-01-17-session-logging.md","acceptance_criteria":"chord-prog mode fully instrumented","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-17T12:02:13.908023294-08:00","created_by":"Wilfred Allyn","updated_at":"2026-01-17T12:14:00.704688927-08:00","closed_at":"2026-01-17T12:14:00.704688927-08:00","close_reason":"Merged into the-shed-roa.12 (All 20 Modes) per review recommendation","dependencies":[{"issue_id":"the-shed-roa.3","depends_on_id":"the-shed-roa","type":"parent-child","created_at":"2026-01-17T12:02:13.909038336-08:00","created_by":"Wilfred Allyn"},{"issue_id":"the-shed-roa.3","depends_on_id":"the-shed-roa.1","type":"blocks","created_at":"2026-01-17T12:02:50.868717506-08:00","created_by":"Wilfred Allyn"}]}
{"id":"the-shed-roa.4","title":"Mode Instrumentation: Scales \u0026 Intervals Group (6 modes)","description":"Add logging hooks to the scales and intervals practice modes.\n\n**Modes to instrument:**\n1. scales - Scale practice\n2. scale-id - Scale identification\n3. intervals - Interval practice\n4. interval-id - Interval identification\n5. rel-pitch - Relative pitch\n6. ear-train - Ear training\n\n**Pattern for each mode:**\n- StartGame() calls sessionLogStartSession(mode, config)\n- NextChallenge() calls sessionLogStartRound(challenge)\n- Correct-answer handler calls sessionLogEndRound(result)\n- EndGame() calls sessionLogEndSession(summary)\n\n**Scope boundaries:**\n- Only these 6 modes - other mode groups are separate tasks","design":"## Task Context\nConnects the logging infrastructure to scales and intervals modes. Same pattern for each mode - StartGame/NextChallenge/EndRound/EndGame lifecycle hooks.\n\n**Work Item:** 3 - Mode Instrumentation | **Epic:** the-shed-roa | **Spec:** thoughts/specs/2026-01-17-session-logging.md","acceptance_criteria":"ear-train mode fully instrumented","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-17T12:02:15.372764545-08:00","created_by":"Wilfred Allyn","updated_at":"2026-01-17T12:14:00.708095927-08:00","closed_at":"2026-01-17T12:14:00.708095927-08:00","close_reason":"Merged into the-shed-roa.12 (All 20 Modes) per review recommendation","dependencies":[{"issue_id":"the-shed-roa.4","depends_on_id":"the-shed-roa","type":"parent-child","created_at":"2026-01-17T12:02:15.373573253-08:00","created_by":"Wilfred Allyn"},{"issue_id":"the-shed-roa.4","depends_on_id":"the-shed-roa.1","type":"blocks","created_at":"2026-01-17T12:02:50.919509881-08:00","created_by":"Wilfred Allyn"}]}
{"id":"the-shed-roa.5","title":"Mode Instrumentation: Theory \u0026 Skills Group (7 modes)","description":"Add logging hooks to the theory and skills practice modes.\n\n**Modes to instrument:**\n1. note-id - Note identification\n2. key-sig - Key signature practice\n3. ii-v-i - ii-V-I progressions\n4. tritone-sub - Tritone substitution\n5. melody-match - Melody matching\n6. rhythm - Rhythm practice\n7. sight-read - Sight reading\n\n**Pattern for each mode:**\n- StartGame() calls sessionLogStartSession(mode, config)\n- NextChallenge() calls sessionLogStartRound(challenge)\n- Correct-answer handler calls sessionLogEndRound(result)\n- EndGame() calls sessionLogEndSession(summary)\n\n**Scope boundaries:**\n- Only these 7 modes - other mode groups are separate tasks","design":"## Task Context\nConnects the logging infrastructure to theory and skills modes. Same pattern for each mode - StartGame/NextChallenge/EndRound/EndGame lifecycle hooks.\n\n**Work Item:** 3 - Mode Instrumentation | **Epic:** the-shed-roa | **Spec:** thoughts/specs/2026-01-17-session-logging.md","acceptance_criteria":"sight-read mode fully instrumented","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-17T12:02:16.421709004-08:00","created_by":"Wilfred Allyn","updated_at":"2026-01-17T12:14:00.710433219-08:00","closed_at":"2026-01-17T12:14:00.710433219-08:00","close_reason":"Merged into the-shed-roa.12 (All 20 Modes) per review recommendation","dependencies":[{"issue_id":"the-shed-roa.5","depends_on_id":"the-shed-roa","type":"parent-child","created_at":"2026-01-17T12:02:16.422658462-08:00","created_by":"Wilfred Allyn"},{"issue_id":"the-shed-roa.5","depends_on_id":"the-shed-roa.1","type":"blocks","created_at":"2026-01-17T12:02:50.956293339-08:00","created_by":"Wilfred Allyn"}]}
{"id":"the-shed-roa.6","title":"Header Toggle Button","description":"Add a quick toggle button in the header for turning session logging on/off.\n\n**What needs to be built:**\n- Toggle button in header area (near existing controls, ~line 140)\n- Visual state indicator (e.g., \"Log: On\" / \"Log: Off\" or icon with indicator)\n- Click handler to toggle sessionLogEnabled and call saveAllSettings()\n\n**Scope boundaries:**\n- Only the header toggle UI and click handler\n- Does NOT implement persistence - uses saveAllSettings() from Settings Persistence task\n- Button styling should match existing header elements","design":"## Task Context\nUsers need quick access to turn logging on/off without digging into settings. This is the primary control point during practice sessions.\n\n**Work Item:** 4 - Header Toggle Button | **Epic:** the-shed-roa | **Spec:** thoughts/specs/2026-01-17-session-logging.md","acceptance_criteria":"Visual feedback on state change","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-17T12:02:17.727349921-08:00","created_by":"Wilfred Allyn","updated_at":"2026-01-17T12:14:43.716107627-08:00","dependencies":[{"issue_id":"the-shed-roa.6","depends_on_id":"the-shed-roa","type":"parent-child","created_at":"2026-01-17T12:02:17.728167879-08:00","created_by":"Wilfred Allyn"},{"issue_id":"the-shed-roa.6","depends_on_id":"the-shed-roa.1","type":"blocks","created_at":"2026-01-17T12:02:50.989254756-08:00","created_by":"Wilfred Allyn"},{"issue_id":"the-shed-roa.6","depends_on_id":"the-shed-roa.9","type":"blocks","created_at":"2026-01-17T12:14:45.432870837-08:00","created_by":"Wilfred Allyn"}]}
{"id":"the-shed-roa.7","title":"JSON Export Function","description":"Implement JSON export for full session data.\n\n**What needs to be built:**\n- exportSessionLogJSON() function\n- Metadata wrapper with export date, version, session count\n- Download trigger with filename piano-tutor-sessions-{date}.json\n\n**Scope boundaries:**\n- Only the JSON export - CSV exports are separate\n- Does not include UI button (that's in Session Log Panel task)","design":"## Task Context\nEnables programmatic analysis with Python, JavaScript, or other tools. This is the most complete export format with full data fidelity.\n\n**Work Item:** 6 - JSON Export | **Epic:** the-shed-roa | **Spec:** thoughts/specs/2026-01-17-session-logging.md","acceptance_criteria":"File is valid JSON parseable by standard tools","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-17T12:02:18.888366338-08:00","created_by":"Wilfred Allyn","updated_at":"2026-01-17T12:02:18.888366338-08:00","dependencies":[{"issue_id":"the-shed-roa.7","depends_on_id":"the-shed-roa","type":"parent-child","created_at":"2026-01-17T12:02:18.888895213-08:00","created_by":"Wilfred Allyn"},{"issue_id":"the-shed-roa.7","depends_on_id":"the-shed-roa.1","type":"blocks","created_at":"2026-01-17T12:02:51.026112964-08:00","created_by":"Wilfred Allyn"}]}
{"id":"the-shed-roa.8","title":"CSV Export Functions","description":"Implement CSV export functions for spreadsheet analysis.\n\n**What needs to be built:**\n- exportSessionLogSummaryCSV() - one row per round\n  - Columns: session_id, mode, config, round_num, challenge_prompt, expected_notes, response_ms, correct, mistakes, slow\n- exportSessionLogDetailedCSV() - one row per MIDI event\n  - Columns: session_id, mode, round_num, challenge_prompt, event_type, midi_note, note_name, octave, offset_ms, is_correct, round_result\n- Proper CSV escaping for commas and quotes\n- Download triggers with appropriate filenames\n\n**Scope boundaries:**\n- Only the export functions - UI buttons are in Session Log Panel task","design":"## Task Context\nEnables spreadsheet analysis (Excel, Google Sheets) and quick pivot table creation. Summary CSV for high-level analysis, detailed CSV for keystroke-level debugging.\n\n**Work Item:** 7 - CSV Export Functions | **Epic:** the-shed-roa | **Spec:** thoughts/specs/2026-01-17-session-logging.md","acceptance_criteria":"Files open correctly in Excel and Google Sheets","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-17T12:02:20.092756589-08:00","created_by":"Wilfred Allyn","updated_at":"2026-01-17T12:02:20.092756589-08:00","dependencies":[{"issue_id":"the-shed-roa.8","depends_on_id":"the-shed-roa","type":"parent-child","created_at":"2026-01-17T12:02:20.093712006-08:00","created_by":"Wilfred Allyn"},{"issue_id":"the-shed-roa.8","depends_on_id":"the-shed-roa.1","type":"blocks","created_at":"2026-01-17T12:02:51.058164673-08:00","created_by":"Wilfred Allyn"}]}
{"id":"the-shed-roa.9","title":"Settings Persistence","description":"Integrate session logging enabled state into existing settings system. This task OWNS the persistence mechanism.\n\n**What needs to be built:**\n- Add sessionLogEnabled to saveAllSettings() function\n- Add sessionLogEnabled to loadAllSettings() function  \n- Initialize sessionLogEnabled state on page load\n- Update header toggle button visual state after load\n\n**Scope boundaries:**\n- Only the settings persistence integration around line 13363\n- Header toggle button UI is separate task (uses this mechanism)","design":"## Task Context\nUsers shouldn't have to re-enable logging every time they reload the page. This integrates with the existing settings persistence system.\n\n**Work Item:** 9 - Settings Persistence | **Epic:** the-shed-roa | **Spec:** thoughts/specs/2026-01-17-session-logging.md","acceptance_criteria":"Added to saveAllSettings() and loadAllSettings() functions","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-17T12:02:21.980093131-08:00","created_by":"Wilfred Allyn","updated_at":"2026-01-17T12:14:50.230900547-08:00","dependencies":[{"issue_id":"the-shed-roa.9","depends_on_id":"the-shed-roa","type":"parent-child","created_at":"2026-01-17T12:02:21.987770506-08:00","created_by":"Wilfred Allyn"},{"issue_id":"the-shed-roa.9","depends_on_id":"the-shed-roa.1","type":"blocks","created_at":"2026-01-17T12:02:51.091260423-08:00","created_by":"Wilfred Allyn"}]}
